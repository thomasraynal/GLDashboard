"use strict";window.OneDashboard={isUndefinedOrNull:function(e){return angular.isUndefined(e)||null===e}},angular.module("glDashboardTemplates",[]);var glDashboard=angular.module("glDashboard",["dx","ngRoute","glDashboardTemplates"]);function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}glDashboard.constant("events",{layoutChanged:"layoutChanged"}),glDashboard.controller("bindable",["$scope",function(n){n.onEvent=function(e,t){n.container.layoutManager.eventHub.on(e,t),n.container.layoutManager.eventHub.on(e,function(){})}}]),glDashboard.controller("widget",["$scope","$timeout","$q","container","workspace","error",function(n,o,t,e,a,i){n.workspace=a,n.container=e,n.name=e._config.componentState.name,n.config=e._config.componentState.config,n.isLoading=!1,n.$watch("isLoading",function(){n.isLoading?n.container._element.addClass("disable"):n.container._element.removeClass("disable")}),n.doUiWork=function(e,t){return n.disable(),(e.then?e:o(function(){return e()})).then(function(e){return null!=t&&t(e),n.enable(),e}).catch(function(e){n.workspace.currentError=i.createError(e),n.workspace.showErrorPopup=!0,n.workspace.$digest(),n.enable()})},n.changeName=function(e){n.config.title=e,n.container.setTitle(e)},n.height=function(){return n.container._element.height()},n.width=function(){return n.container._element.width()},n.disable=function(){n.isLoading=!0},n.enable=function(){n.isLoading=!1},n.initialize=function(){return(e=t.defer()).resolve(),e.promise;var e},o(function(){n.initialize()})}]),glDashboard.controller("workspace",["$scope","$log","$templateRequest","$templateCache","$timeout","$routeParams","$q","$window","$document","error","widgets","layouts","events","Save","Context",function(i,t,o,a,n,r,u,e,s,l,d,c,p,g,m){var y;function v(){i.isLoading=!0}function f(){i.isLoading=!1}function h(){return i.$workspaceContainer.height($(window).height()),i.$workspaceContainer.width($(window).width()),N()}function w(){var e=_.transform(i.onInitializedHandlers,function(e,t){var n=t;t.then||(n=N(t)),e.push(n)},[]);return u.all(e).catch(function(e){i.currentError=l.createError(e),i.showErrorPopup=!0,f()})}function x(e,t){try{var n=e.getElement(),o=a.get(t.templateUrl);n.html(o),angular.module(t.module).value("container",e).value("workspace",i),angular.bootstrap(n[0],[t.module])}catch(e){i.currentError=l.createError(e),i.showErrorPopup=!0,f()}}function b(){OneDashboard.isUndefinedOrNull(i.goldenLayout)||i.goldenLayout.destroy();var e=i.context.layout;return e.settings.showPopoutIcon=!1,e.content[0].isClosable=!1,i.goldenLayout=new GoldenLayout(e,i.$workspaceContainer),i.goldenLayout.registerComponent("angularModule",x),i.goldenLayout.init(),N()}function L(){return i.doUiWork(OneDashboard.isUndefinedOrNull(i.context)?N():c.getLayout(i.context.layoutKey)).then(function(e){return OneDashboard.isUndefinedOrNull(e)?i.doUiWork(OneDashboard.isUndefinedOrNull(i.context)?N():c.getLayout(i.context.layoutCategory)).then(function(e){return O(e)}):O(e)})}function O(e){return D(e).then(b).then(function(){M(),M()})}function C(){return d.getWidgets().then(function(e){var n=[];return _.each(e,function(e){var t=u.defer();n.push(o(e.templateUrl)),$script(e.moduleUrl,function(){return t.resolve()}),n.push(t.promise)}),u.all(n)})}function D(e){return OneDashboard.isUndefinedOrNull(e)?i.context=new m(r.key,r.category):e.isAction||e.isScreen?i.context=new m(e.layoutKey,r.category,e.isScreen,e.isAction,e.layout):i.context=new m(r.key,r.category,!1,!1,e.layout),N()}function A(){angular.element(e).bind("resize",function(){M()}),angular.element(s).bind("mousemove",function(e){_.throttle(function(){!function(e){if(null==i.goldenLayout)return;if(e<=i.$workspaceContainer.height()-100){if(i.isFullScreen)return;i.isFullScreen=!0,$("#workspaceMenu").hide(150)}else{if(!i.isFullScreen)return;i.isFullScreen=!1,$("#workspaceMenu").show(150)}}(e.pageY)},500)()})}function S(e){return d.getWidget(e).then(function(e){i.goldenLayout.root.contentItems[0].addChild(e)})}function k(e,t,n,o){var a=new m(e,t,n,o,i.goldenLayout.toConfig());return i.doUiWork(c.saveLayout(a)).then(function(e){i.goldenLayout.eventHub.emit(p.layoutChanged)})}function N(e){var t=u.defer();return e&&e(),t.resolve(),t.promise}function M(){n(function(){i.$workspaceContainer.height($(window).height()),i.$workspaceContainer.width($(window).width()),i.goldenLayout.updateSize()})}i.context,i.onInitializedHandlers=[],i.isLoading=!1,i.$workspaceContainer=$("#workspaceContainer"),i.isFullScreen,i.showNamedLayoutManagement=!1,i.showCurrentUser=!1,i.isSaveLayoutDefaultDisabled,i.availableWidgets=[],i.showErrorPopup=!1,i.currentError,i.saveContextAsScreenOrActionVisible=!1,i.saveContextAsScreenOrActionLabel=null,i.errorPopup=(_defineProperty(y={contentTemplate:"info",width:600,height:500,showTitle:!1,dragEnabled:!1},"showTitle",!0),_defineProperty(y,"title","An error has occured"),_defineProperty(y,"closeOnOutsideClick",!0),_defineProperty(y,"bindingOptions",{visible:"showErrorPopup"}),y),i.errorDetails={height:350,bindingOptions:{value:"currentError.details"}},i.$watch("context",function(){null!=i.context?(i.context.isAction?i.saveContextAsScreenOrActionLabel="Save ["+i.context.layoutKey+"]":i.context.isScreen?i.saveContextAsScreenOrActionLabel="Save ["+i.context.layoutKey+"]":i.saveContextAsScreenOrActionLabel=null,i.isSaveLayoutDefaultDisabled=OneDashboard.isUndefinedOrNull(i.context.layoutKey)||i.context.isAction||i.context.isScreen):i.saveContextAsScreenOrActionLabel=null}),i.$watch("saveContextAsScreenOrActionLabel",function(){i.saveContextAsScreenOrActionVisible=null!=i.saveContextAsScreenOrActionLabel}),i.$on("$destroy",function(){i.goldenLayout.destroy()}),i.widgetMenuOptions={bindingOptions:{dataSource:"availableWidgets"},hideSubmenuOnMouseLeave:!0,displayExpr:"name",onItemClick:function(e){"category"!=e.itemData.type&&S(e.itemData.name)}},i.onInitialized=function(e){i.onInitializedHandlers.push(e)},i.doUiWork=function(e,t){return v(),(e.then?e:n(function(){return e()})).then(function(e){return null!=t&&t(e),f(),e}).catch(function(e){i.currentError=l.createError(e),i.showErrorPopup=!0,i.workspace.$digest(),f()})},i.saveLayout=k,i.saveLayoutAsDefault=function(){return k(i.context.layoutKey,i.context.layoutCategory,!1,!1)},i.saveLayoutAsDefaultForCategory=function(){return k(null,i.context.layoutCategory,!1,!1)},i.changeContext=D,i.addWidget=S,i.changeLayout=function(e){i.doUiWork(c.getLayout(e)).then(D).then(b)},i.clearLayout=function(){return D().then(b)},i.reload=L,n(function(){n(function(){return v()}).then(h).then(A).then(D).then(C).then(L).then(w).then(f).catch(function(e){t.error(e),i.currentError=l.createError(e),i.showErrorPopup=!0,f()})})}]),glDashboard.directive("workspaceMenuActionsAndScreens",["layouts","events",function(a,i){return{restrict:"E",templateUrl:"view.menu.actions.and.screens.html",controller:["$scope",function(t){function e(e){"category"!=e.itemData.type&&t.changeLayout(e.itemData.name)}function n(){return a.getAvailableScreens().then(function(e){t.screens=[{name:"Screens",type:"category",items:_.transform(e,function(e,t){return e.push({name:t.layoutKey,type:"screen"})},[])}]})}function o(){return a.getAvailableActions().then(function(e){t.actions=[{name:"Actions",type:"category",items:_.transform(e,function(e,t){return e.push({name:t.layoutKey,type:"action"})},[])}]})}t.onInitialized(function(){n(),o(),t.goldenLayout.eventHub.on(i.layoutChanged,function(e){o(),n()})}),t.actions=[],t.screens=[],t.actionMenuOptions={bindingOptions:{dataSource:"actions"},hideSubmenuOnMouseLeave:!0,displayExpr:"name",onItemClick:e},t.screenMenuOptions={bindingOptions:{dataSource:"screens"},hideSubmenuOnMouseLeave:!0,displayExpr:"name",onItemClick:e}}]}}]),glDashboard.directive("workspaceMenuAppName",function(){return{restrict:"E",templateUrl:"view.menu.app.name.html",link:function(e){}}}),glDashboard.directive("workspaceMenuLayoutClear",["layouts","events",function(e,t){return{restrict:"E",templateUrl:"view.menu.layout.clear.html",controller:["$scope",function(t){t.clearLayoutButtonOptions={icon:"trash",hint:"Clear Layout",onClick:function(e){t.clearLayout()}}}]}}]),glDashboard.directive("workspaceMenuLayoutManagement",["layouts","events",function(n,a){return{restrict:"E",templateUrl:"view.menu.layout.management.html",controller:["$scope",function(o){function e(){o.showLayoutManagement&&(o.selectedLayout=null,o.newLayoutName="",n.getAvailableLayouts().then(function(e){o.availableLayouts=_.transform(e,function(e,t){var n="DEFAULT";t.isAction&&(n="ACTION"),t.isScreen&&(n="SCREEN"),t.isAction||t.isScreen||t.isDefault||(n="DEFAULT (USER)"),t.isAction||t.isScreen||!t.isDefault||(n="DEFAULT"),e.push({category:n,isDefault:t.isDefault,layout:t,name:OneDashboard.isUndefinedOrNull(t.layoutKey)?t.layoutCategory:t.layoutKey})},[])}).catch(function(e){$log.error(e)}))}o.showLayoutManagement=!1,o.newLayoutName="",o.selectedLayout,o.isLayoutManagementDisabled,o.isDeleteLayoutDisabled,o.availableLayouts=[],o.$watch("selectedLayout",function(){o.isLayoutManagementDisabled=null==o.selectedLayout,o.isDeleteLayoutDisabled=o.isLayoutManagementDisabled||o.selectedLayout.isDefault}),o.$watch("newLayoutName",function(){o.isSaveLayoutDisabled=OneDashboard.isUndefinedOrNull(o.newLayoutName)||""==o.newLayoutName}),o.$watch("showLayoutManagement",function(){e()}),o.textBoxNewLayoutOptions={bindingOptions:{value:"newLayoutName"},showClearButton:!0,placeholder:"Enter layout name...",onInput:function(e){o.newLayoutName=e.component._options.text}},o.layoutManagementGridBoxOptions={bindingOptions:{value:"selectedLayout.name",dataSource:"availableLayouts"},valueExpr:"name",placeholder:"Select a layout...",displayExpr:function(e){return e&&e.name+" ["+e.category+"]"},showClearButton:!0,dataGrid:{bindingOptions:{dataSource:"availableLayouts"},columns:["name","category"],hoverStateEnabled:!0,filterRow:{visible:!0},scrolling:{mode:"infinite"},selection:{mode:"single"},height:300,onSelectionChanged:function(e){var t=e.selectedRowKeys;o.selectedLayout=t.length&&t[0]||null,$("#layoutManagementGridBox").dxDropDownBox("instance").close()}}},o.saveLayoutAsScreenButtonOptions={icon:"floppy",text:"Save As Screen",bindingOptions:{disabled:"isSaveLayoutDisabled"},onClick:function(e){o.saveLayout(o.newLayoutName,o.context.layoutKey,!0,!1).then(function(){o.showLayoutManagement=!1})}},o.saveLayoutAsActionButtonOptions={icon:"floppy",text:"Save As Action",bindingOptions:{disabled:"isSaveLayoutDisabled"},onClick:function(e){o.saveLayout(o.newLayoutName,o.context.layoutKey,!1,!0).then(function(){o.showLayoutManagement=!1})}},o.loadLayoutButtonOptions={icon:"upload",text:"Load",bindingOptions:{disabled:"isLayoutManagementDisabled"},onClick:function(e){o.changeLayout(o.selectedLayout.name),o.showLayoutManagement=!1}},o.deleteLayoutButtonOptions={icon:"trash",text:"Delete",bindingOptions:{disabled:"isDeleteLayoutDisabled"},onClick:function(e){var t;t=o.selectedLayout.layout,o.doUiWork(n.deleteLayout(t)).then(function(e){o.goldenLayout.eventHub.emit(a.layoutChanged)}),o.showLayoutManagement=!1}},o.saveLayoutAsFileButtonOptions={icon:"floppy",text:"Save As File",onClick:function(e){var t=JSON.stringify(o.goldenLayout.toConfig()),n=o.context.layoutKey?o.context.layoutKey+"_"+o.context.layoutCategory:o.context.layoutCategory;new Save(n,".layout",t),o.showLayoutManagement=!1}},o.layoutManagementButtonOptions={icon:"image",hint:"Show Layout Management Panel",onClick:function(e){o.showLayoutManagement=!0}},o.layoutManagementPopupOptions={width:300,height:375,showTitle:!0,title:"Layout Management",dragEnabled:!1,closeOnOutsideClick:!0,bindingOptions:{visible:"showLayoutManagement"}},o.loadLayoutFromFileUploadOptions={icon:"upload",selectButtonText:"Load From File",labelText:"",accept:".layout",uploadMode:"instantly",onValueChanged:function(e){if(0!=e.value.length){var t=e.value[0],n=new FileReader;n.onload=function(e){var t=$("#loadLayoutFromFileInput").dxFileUploader("instance"),n=JSON.parse(e.target.result);o.context.layout=n,initGoldenLayout().then(function(){t.reset()})},n.readAsBinaryString(t),o.showLayoutManagement=!1}}},o.showLayoutManagementPopup=e}]}}]),glDashboard.directive("workspaceMenuLayoutSave",function(){return{restrict:"E",templateUrl:"view.menu.layout.save.html",controller:["$scope",function(e){e.saveLayoutDefaultButtonOptions={icon:"floppy",bindingOptions:{text:"context.layoutKey",disabled:"isSaveLayoutDefaultDisabled"},onClick:e.saveLayoutAsDefault},e.saveLayoutTagButtonOptions={icon:"floppy",bindingOptions:{text:"context.layoutCategory"},onClick:e.saveLayoutAsDefaultForCategory}}]}}),glDashboard.directive("workspaceMenuLayoutSaveScreenOrAction",function(){return{restrict:"E",templateUrl:"view.menu.layout.save.screen.or.action.html",controller:["$scope",function(t){t.saveLayoutAsScreenOrActionButtonOptions={icon:"floppy",bindingOptions:{text:"saveContextAsScreenOrActionLabel",visible:"saveContextAsScreenOrActionVisible"},onClick:function(e){saveLayout(t.context.layoutKey,t.context.layoutKey,t.context.isScreen,t.context.isAction)}}}]}}),glDashboard.directive("workspaceMenuWidgets",["widgets","events",function(n,o){return{restrict:"E",templateUrl:"view.menu.widgets.html",controller:["$scope","$timeout",function(l,e){function t(){return n.getWidgets().then(function(e){var u,s,t,n=(u=e,s=[],t=_.transform(u,function(e,t){_.find(e,function(e){return e===t.category})||""!=t.category&&e.push(t.category)},[]),_.each(t,function(e){var i=null,t=e.split(";"),r=null;_.each(t,function(t){r=null==r?t:r+";"+t;var e=null!=_.find(s,function(e){return e.name===t});if(OneDashboard.isUndefinedOrNull(i)&&!e)i={name:t,gl_template:null,type:"category",disabled:!1,config:null,items:[]},s.push(i);else{var n=null;if(e)i=n=_.find(s,function(e){return e.name===t});else{n=_.find(i.items,function(e){return e.name===t});var o={name:t,gl_template:null,type:"category",disabled:!1,config:null,items:[]};null==n?i.items.push(o):n.items.push(o),i=o}}var a=_.filter(u,function(e){return e.category===r});_.each(a,function(t){_.find(i.items,function(e){return t.name===e.name})||i.items.push({name:t.name,gl_template:t.template,type:"widget",disabled:OneDashboard.isUndefinedOrNull(l.context.layoutKey)&&t.isKeyBounded,config:null==t.config?{}:t.config})})})}),s);l.availableWidgets=[{name:"Widgets",type:"category",items:n}]})}l.onInitialized(function(){t(),l.goldenLayout.eventHub.on(o.layoutChanged,function(e){t()})})}]}}]),glDashboard.directive("workspaceMenu",function(){return{restrict:"E",templateUrl:"plugins/html/view.menu.html",link:function(e){}}}),glDashboard.directive("changeWidgetName",function(){return{restrict:"E",templateUrl:"view.widget.name.html",link:function(t){t.showChangeWidgetnamePopup=!1,t.widgetNewName=t.config.title,t.cannotValidateWidgetNameChange=!0,t.changeWidgetNameButtonOptions={icon:"edit",onClick:function(e){t.widgetNewName=t.config.title,t.showChangeWidgetnamePopup=!0}},t.$watch("widgetNewName",function(){t.cannotValidateWidgetNameChange=""==t.widgetNewName}),t.widgetNameTextBoxOptions={bindingOptions:{value:"widgetNewName"},onInput:function(e){t.cannotValidateWidgetNameChange=""==e.component._options.text},showClearButton:!0},t.changeWidgetNamePopupOptions={width:350,contentTemplate:"info",height:"auto",dragEnabled:!0,showTitle:!0,title:"Change widget name",closeOnOutsideClick:!0,bindingOptions:{visible:"showChangeWidgetnamePopup"}},t.validateChangeNameButtonOptions={text:"Change name",bindingOptions:{disabled:"cannotValidateWidgetNameChange"},onClick:function(){t.changeName(t.widgetNewName),t.showChangeWidgetnamePopup=!1}}}}}),glDashboard.factory("Save",function(){return function(e,t,n,o){saveAs(new Blob([function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),o=0;o!=e.length;++o)n[o]=255&e.charCodeAt(o);return t}(n)],{type:o||"application/octet-stream"}),e+t)}}),angular.module("glDashboardTemplates").run(["$templateCache",function(e){e.put("view.menu.actions.and.screens.html",'    <div class="menu-item" dx-menu="actionMenuOptions"></div>\r\n    <div class="menu-item" dx-menu="screenMenuOptions"></div>'),e.put("view.menu.app.name.html",'<a style="color: transparent!important;" ng-href="#/"><img style="margin-left:0px" class="menu-item" src={{appIcon}}></img>\r\n</a>\r\n<div class="menu-item-align">{{appName}}</div>\r\n<div class="menu-item-align">v.{{appVersion}}</div>\r\n<div class="menu-item-align">{{fund}}</div>\r\n'),e.put("view.menu.layout.clear.html",'<div class="icon-menu-item" dx-button="clearLayoutButtonOptions"></div>'),e.put("view.menu.layout.management.html",'<div class="menu-item" dx-button="layoutManagementButtonOptions">\r\n</div>\r\n<div id="layoutManagementPopup" class="popup" dx-popup="layoutManagementPopupOptions">\r\n    <div>\r\n        <div class="dx-fieldset">\r\n            <div class="dx-fieldset-header">Create a named layout</div>\r\n            <div class="dx-field">\r\n                <div style="width:100%;min-height:30px;margin-top: 5px;">\r\n                    <div style="width:250px;" dx-text-box="textBoxNewLayoutOptions"></div>\r\n                </div>\r\n            </div>\r\n            <div class="dx-field">\r\n                <div style="width:100%;min-height:30px;margin-top: 5px;">\r\n                    <div dx-button="saveLayoutAsScreenButtonOptions"></div>\r\n                    <div dx-button="saveLayoutAsActionButtonOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="dx-fieldset">\r\n            <div class="dx-fieldset-header">Create or load a serialized layout</div>\r\n            <div class="dx-field">\r\n                <div style="width:100%;min-height:30px;margin-top: 5px;">\r\n                    <div style="float:left;width:125px;" dx-button="saveLayoutAsFileButtonOptions"></div>\r\n                    <div style="float:left;width:125px;margin-top: -7px;" class="menu-item" id="loadLayoutFromFileInput" dx-file-uploader="loadLayoutFromFileUploadOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="dx-fieldset">\r\n            <div class="dx-fieldset-header">Manage existing layouts</div>\r\n            <div class="dx-field">\r\n                <div>\r\n                    <div id="layoutManagementGridBox" dx-drop-down-box="layoutManagementGridBoxOptions">\r\n                        <div data-options="dxTemplate: { name: \'content\' }">\r\n                            <div dx-data-grid="layoutManagementGridBoxOptions.dataGrid"></div>\r\n                        </div>\r\n                    </div>\r\n                    <div style="margin-top:10px;">\r\n                        <div style="width:125px;" dx-button="loadLayoutButtonOptions"></div>\r\n                        <div style="width:125px" dx-button="deleteLayoutButtonOptions"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'),e.put("view.menu.layout.save.html",'<div class="menu-item" dx-button="saveLayoutDefaultButtonOptions"></div>\r\n<div class="menu-item" dx-button="saveLayoutTagButtonOptions"></div>\r\n'),e.put("view.menu.layout.save.screen.or.action.html",'<div class="menu-item" dx-button="saveLayoutAsScreenOrActionButtonOptions"></div>\r\n'),e.put("view.menu.widgets.html",'<div class="menu-item" dx-menu="widgetMenuOptions"></div>\r\n'),e.put("view.widget.name.html",'<div class="menu-item" dx-button="changeWidgetNameButtonOptions"></div>\r\n<div class="popup" dx-popup="changeWidgetNamePopupOptions">\r\n    <div data-options="dxTemplate: { name: \'info\' } ">\r\n        <div style="margin-top:10px;" dx-text-box="widgetNameTextBoxOptions"></div>\r\n        <div style="width:100%;margin-top:10px;min-height:30px; ">\r\n            <div style="width:100%;margin:0px" dx-button="validateChangeNameButtonOptions"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'),e.put("view.workspace.html",'<div ng-class="{disable: isLoading}">\r\n    <div id="workspaceContainer" class="gld_workspace_container"></div>\r\n    <workspace-menu></workspace-menu>\r\n    <div class="popup" dx-popup="errorPopup">\r\n        <div data-options="dxTemplate: { name:\'info\' }">\r\n            <div class="dx-fieldset">\r\n                <div class="dx-field">\r\n                    <div class="dx-field-label">Type</div>\r\n                    <div class="dx-field-value">\r\n                        {{currentError.status}}\r\n                    </div>\r\n                </div>\r\n                <div class="dx-field">\r\n                    <div class="dx-field-label">Message</div>\r\n                    <div class="dx-field-value">\r\n                        {{currentError.message}}\r\n                    </div>\r\n                </div>\r\n                <div class="dx-field">\r\n                    <div class="dx-field-label">Detail</div>\r\n                    <div class="dx-field-value">\r\n                        <div dx-text-area="errorDetails"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n')}]),glDashboard.service("error",function(){this.createError=function(e){var t={status:"",message:"",details:"",inner:null};return(t.inner=e)instanceof Error?(t.status="An error has occured",t.message=e.message,t.details=e.stack):e.hasOwnProperty("statusText")&&e.hasOwnProperty("data")&&e.hasOwnProperty("data")?null!=e.data?(t.status=e.statusText,t.message=e.data.message,t.details=JSON.stringify(e.data)):(t.status="HTTP error - see trace for details",t.message="An error has occured",t.details=JSON.stringify(e.config)):t.details=e,t}});