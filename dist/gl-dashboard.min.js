"use strict";window.OneDashboard={isUndefinedOrNull:function(e){return angular.isUndefined(e)||null===e}},angular.module("oneDasboardTemplates",[]);var glDashboard=angular.module("glDashboard",["dx","ngRoute","oneDasboardTemplates"]);function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}glDashboard.constant("events",{layoutChanged:"layoutChanged"}),glDashboard.controller("bindable",["$scope",function(n){n.onEvent=function(e,t){n.container.layoutManager.eventHub.on(e,t),n.container.layoutManager.eventHub.on(e,function(){})}}]),glDashboard.controller("widget",["$scope","$timeout","$q","container","workspace","error",function(n,e,t,o,a,i){n.workspace=a,n.container=o,n.name=o._config.componentState.name,n.config=o._config.componentState.config,n.doUiWork=function(e,t){return n.disable(),(e.then?e:e()).then(function(e){return null!=t&&t(e),n.enable(),e}).catch(function(e){n.workspace.currentError=i.createError(e),n.workspace.showErrorPopup=!0,n.workspace.$digest(),n.enable()})},n.changeWidgetName=function(e){n.config.title=e,n.container.setTitle(e)},n.height=function(){return n.container._element.height()},n.width=function(){return n.container._element.width()},n.isUpdating=function(){return n.container._element.hasClass("disable")},n.disable=function(){n.container._element.addClass("disable")},n.enable=function(){n.container._element.removeClass("disable")},n.initialize=function(){return(e=t.defer()).resolve(),e.promise;var e},e(function(){n.initialize()})}]),glDashboard.controller("workspace",["$scope","$log","$templateRequest","$templateCache","$timeout","$routeParams","$q","$window","$document","error","widgets","layouts","events","Save","Context",function(u,t,o,a,n,i,r,e,s,l,d,c,p,g,y){var m;function f(){return n(function(){u.isLoading=!0})}function v(){return n(function(){u.isLoading=!1})}function h(e,t){try{var n=e.getElement(),o=a.get(t.templateUrl);n.html(o),angular.module(t.module).value("container",e).value("workspace",u),angular.bootstrap(n[0],[t.module])}catch(e){u.currentError=l.createError(e),u.showErrorPopup=!0,v()}}function x(){OneDashboard.isUndefinedOrNull(u.goldenLayout)||u.goldenLayout.destroy();var e=u.context.layout;return e.settings.showPopoutIcon=!1,e.content[0].isClosable=!1,u.goldenLayout=new GoldenLayout(e,u.$workspaceContainer),u.goldenLayout.registerComponent("angularModule",h),u.goldenLayout.init(),u.goldenLayout.eventHub.on(p.layoutChanged,function(e){O(),A(),C()}),B()}function w(){u.doUiWork(OneDashboard.isUndefinedOrNull(u.context)?B():c.getLayout(u.context.layoutKey)).then(function(e){OneDashboard.isUndefinedOrNull(e)?u.doUiWork(OneDashboard.isUndefinedOrNull(u.context)?B():c.getLayout(u.context.layoutCategory)).then(function(e){b(e)}):b(e)})}function b(e){D(e).then(x).then(function(){P(),P()})}function L(){return d.getWidgets().then(function(e){var n=[];return _.each(e,function(e){var t=r.defer();n.push(o(e.templateUrl)),$script(e.moduleUrl,function(){return t.resolve()}),n.push(t.promise)}),r.all(n)})}function O(){return d.getWidgets().then(function(e){var s,l,t,n=(s=e,l=[],t=_.transform(s,function(e,t){_.find(e,function(e){return e===t.category})||""!=t.category&&e.push(t.category)},[]),_.each(t,function(e){var i=null,t=e.split(";"),r=null;_.each(t,function(t){r=null==r?t:r+";"+t;var e=null!=_.find(l,function(e){return e.name===t});if(OneDashboard.isUndefinedOrNull(i)&&!e)i={name:t,gl_template:null,type:"category",disabled:!1,config:null,items:[]},l.push(i);else{var n=null;if(e)i=n=_.find(l,function(e){return e.name===t});else{n=_.find(i.items,function(e){return e.name===t});var o={name:t,gl_template:null,type:"category",disabled:!1,config:null,items:[]};null==n?i.items.push(o):n.items.push(o),i=o}}var a=_.filter(s,function(e){return e.category===r});_.each(a,function(t){_.find(i.items,function(e){return t.name===e.name})||i.items.push({name:t.name,gl_template:t.template,type:"widget",disabled:OneDashboard.isUndefinedOrNull(u.context.layoutKey)&&t.isKeyBounded,config:null==t.config?{}:t.config})})})}),l);u.availableWidgets=[{name:"Widgets",type:"category",items:n}]})}function C(){return c.getAvailableScreens().then(function(e){u.screens=[{name:"Screens",type:"category",items:_.transform(e,function(e,t){return e.push({name:t.layoutKey,type:"screen"})},[])}]})}function A(){return c.getAvailableActions().then(function(e){u.actions=[{name:"Actions",type:"category",items:_.transform(e,function(e,t){return e.push({name:t.layoutKey,type:"action"})},[])}]})}function D(e){return OneDashboard.isUndefinedOrNull(e)?u.context=new y(i.key,i.category):e.isAction||e.isScreen?u.context=new y(e.layoutKey,i.category,e.isScreen,e.isAction,e.layout):u.context=new y(i.key,i.category,!1,!1,e.layout),B()}function S(){angular.element(e).bind("resize",function(){P()}),angular.element(s).bind("mousemove",function(e){_.throttle(function(){!function(e){if(null==u.goldenLayout)return;if(e<=u.$workspaceContainer.height()-100){if(u.isFullScreen)return;u.isFullScreen=!0,$("#workspaceMenu").hide(150)}else{if(!u.isFullScreen)return;u.isFullScreen=!1,$("#workspaceMenu").show(150)}}(e.pageY)},500)()})}function N(e){return d.getWidget(e).then(function(e){u.goldenLayout.root.contentItems[0].addChild(e)})}function k(e){"category"!=e.itemData.type&&M(e.itemData.name)}function M(e){u.doUiWork(c.getLayout(e)).then(D).then(function(){return u.showNamedLayoutManagement=!1,u.showlayoutManagement=!1,n(function(){x()},200),B()})}function E(e,t,n,o){var a=new y(e,t,n,o,u.goldenLayout.toConfig());return u.doUiWork(c.saveLayout(a)).then(function(e){u.newLayoutName="",u.goldenLayout.eventHub.emit(p.layoutChanged)})}function T(){return E(u.context.layoutKey,u.context.layoutCategory,!1,!1)}function U(){return E(null,u.context.layoutCategory,!1,!1)}function B(){var e=r.defer();return e.resolve(),e.promise}function P(){n(function(){u.$workspaceContainer.height($(window).height()),u.$workspaceContainer.width($(window).width()),u.goldenLayout.updateSize()})}u.context,u.actions=[],u.screens=[],u.isLoading=!1,u.$workspaceContainer=$("#workspaceContainer"),u.isFullScreen,u.showNamedLayoutManagement=!1,u.showlayoutManagement=!1,u.showCurrentUser=!1,u.isSaveCustomLayoutDisabled,u.isSaveLayoutDefaultDisabled,u.isLayoutManagementDisabled,u.isDeleteLayoutDisabled,u.newLayoutName="",u.selectedLayout,u.availableWidgets=[],u.availableLayouts=[],u.showErrorPopup=!1,u.currentError,u.saveContextAsScreenOrActionVisible=!1,u.saveContextAsScreenOrActionLabel=null,u.errorPopup=(_defineProperty(m={contentTemplate:"info",width:600,height:500,showTitle:!1,dragEnabled:!1},"showTitle",!0),_defineProperty(m,"title","An error has occured"),_defineProperty(m,"closeOnOutsideClick",!0),_defineProperty(m,"bindingOptions",{visible:"showErrorPopup"}),m),u.errorDetails={height:350,bindingOptions:{value:"currentError.details"}},u.$watch("context",function(){null!=u.context?(u.context.isAction?u.saveContextAsScreenOrActionLabel="Save ["+u.context.layoutKey+"]":u.context.isScreen?u.saveContextAsScreenOrActionLabel="Save ["+u.context.layoutKey+"]":u.saveContextAsScreenOrActionLabel=null,u.isSaveLayoutDefaultDisabled=OneDashboard.isUndefinedOrNull(u.context.layoutKey)||u.context.isAction||u.context.isScreen):u.saveContextAsScreenOrActionLabel=null}),u.$watch("saveContextAsScreenOrActionLabel",function(){u.saveContextAsScreenOrActionVisible=null!=u.saveContextAsScreenOrActionLabel}),u.$watch("newLayoutName",function(){u.isSaveLayoutDisabled=OneDashboard.isUndefinedOrNull(u.newLayoutName)||""==u.newLayoutName}),u.$watch("selectedLayout",function(){u.isLayoutManagementDisabled=null==u.selectedLayout,u.isDeleteLayoutDisabled=u.isLayoutManagementDisabled||u.selectedLayout.isDefault}),u.$on("$destroy",function(){u.goldenLayout.destroy()}),u.widgetMenuOptions={bindingOptions:{dataSource:"availableWidgets"},hideSubmenuOnMouseLeave:!0,displayExpr:"name",onItemClick:function(e){"category"!=e.itemData.type&&N(e.itemData.name)}},u.actionMenuOptions={bindingOptions:{dataSource:"actions"},hideSubmenuOnMouseLeave:!0,displayExpr:"name",onItemClick:k},u.screenMenuOptions={bindingOptions:{dataSource:"screens"},hideSubmenuOnMouseLeave:!0,displayExpr:"name",onItemClick:k},u.textBoxNewLayoutOptions={bindingOptions:{value:"newLayoutName"},showClearButton:!0,placeholder:"Enter layout name...",onInput:function(e){u.newLayoutName=e.component._options.text}},u.saveLayoutDefaultButtonOptions={icon:"floppy",bindingOptions:{text:"context.layoutKey",disabled:"isSaveLayoutDefaultDisabled"},onClick:T},u.saveLayoutTagButtonOptions={icon:"floppy",bindingOptions:{text:"context.layoutCategory"},onClick:U},u.deleteDefaultLayoutButtonOptions={icon:"remove",hint:"Clear Layout",onClick:function(e){D().then(x)}},u.saveLayoutAsScreenOrActionButtonOptions={icon:"floppy",bindingOptions:{text:"saveContextAsScreenOrActionLabel",visible:"saveContextAsScreenOrActionVisible"},onClick:function(e){E(u.context.layoutKey,u.context.layoutKey,u.context.isScreen,u.context.isAction)}},u.saveLayoutAsScreenButtonOptions={icon:"floppy",text:"Save As Screen",bindingOptions:{disabled:"isSaveLayoutDisabled"},onClick:function(e){E(u.newLayoutName,u.context.layoutKey,!0,!1).then(function(){u.showlayoutManagement=!1})}},u.saveLayoutAsActionButtonOptions={icon:"floppy",text:"Save As Action",bindingOptions:{disabled:"isSaveLayoutDisabled"},onClick:function(e){E(u.newLayoutName,u.context.layoutKey,!1,!0).then(function(){u.showlayoutManagement=!1})}},u.loadLayoutButtonOptions={icon:"upload",text:"Load",bindingOptions:{disabled:"isLayoutManagementDisabled"},onClick:function(e){M(u.selectedLayout.text)}},u.deleteLayoutButtonOptions={icon:"trash",text:"Delete",bindingOptions:{disabled:"isDeleteLayoutDisabled"},onClick:function(e){var t;t=u.selectedLayout.text,u.doUiWork(c.deleteLayout(t)).then(function(e){u.goldenLayout.eventHub.emit(p.layoutChanged),u.showNamedLayoutManagement=!1})}},u.namedLayoutManagementButtonOptions={icon:"folder",text:"Show Saved Layouts",onClick:function(e){u.selectedLayout=null,c.getAvailableLayouts().then(function(e){var t=_.transform(e,function(e,t){var n="DEFAULT";t.isAction&&(n="ACTION"),t.isScreen&&(n="MY SCREEN(S)"),t.isAction||t.isScreen||t.isDefault||(n="DEFAULT (USER)"),t.isAction||t.isScreen||!t.isDefault||(n="DEFAULT"),e.push({id:t.layoutKey+t.isAction+t.isScreen+t.isDefault,category:n,isDefault:t.isDefault,text:OneDashboard.isUndefinedOrNull(t.layoutKey)?t.layoutCategory:t.layoutKey})},[]);u.availableLayouts=[{id:"0",text:"Available Layouts",isCategory:!0,expanded:!0,items:[{id:"1",text:"MY SCREEN(S)",isCategory:!0,expanded:!1,items:_.filter(t,function(e){return"MY SCREEN(S)"==e.category})},{id:"2",text:"ACTION",isCategory:!0,expanded:!1,items:_.filter(t,function(e){return"ACTION"==e.category})},{id:"3",text:"DEFAULT (USER)",isCategory:!0,expanded:!1,items:_.filter(t,function(e){return"DEFAULT (USER)"==e.category})},{id:"4",text:"DEFAULT",isCategory:!0,expanded:!1,items:_.filter(t,function(e){return"DEFAULT"==e.category})}]}],u.showNamedLayoutManagement=!0}).catch(function(e){t.error(e)})}},u.saveLayoutAsFileButtonOptions={icon:"floppy",text:"Save As File",onClick:function(e){var t=JSON.stringify(u.goldenLayout.toConfig()),n=u.context.layoutKey?u.context.layoutKey+"_"+u.context.layoutCategory:u.context.layoutCategory;new g(n,".layout",t),u.showlayoutManagement=!1}},u.loadLayoutFromFileUploadOptions={icon:"upload",selectButtonText:"Load From File",labelText:"",accept:".layout",uploadMode:"instantly",onValueChanged:function(e){if(0!=e.value.length){var t=e.value[0],n=new FileReader;n.onload=function(e){var t=$("#loadLayoutFromFileInput").dxFileUploader("instance"),n=JSON.parse(e.target.result);u.context.layout=n,x().then(function(){t.reset()})},n.readAsBinaryString(t),u.showlayoutManagement=!1}}},u.layoutManagementTreeViewOptions={bindingOptions:{items:"availableLayouts"},height:500,onItemClick:function(e){null==e.itemData||e.itemData.isCategory||(u.selectedLayout=e.itemData)}},u.namedLayoutManagementPopupOptions={contentTemplate:"info",width:300,showTitle:!0,title:"Available Layouts",dragEnabled:!1,closeOnOutsideClick:!0,bindingOptions:{visible:"showNamedLayoutManagement"}},u.layoutManagementButtonOptions={icon:"image",hint:"Show Layout Management Panel",onClick:function(e){u.showlayoutManagement=!0}},u.layoutManagementPopupOptions={contentTemplate:"info",width:800,height:300,showTitle:!0,title:"Layout Management",dragEnabled:!1,closeOnOutsideClick:!0,bindingOptions:{visible:"showlayoutManagement"}},u.doUiWork=function(e,t){return f(),(e.then?e:e()).then(function(e){return null!=t&&t(e),v(),e}).catch(function(e){u.currentError=l.createError(e),u.showErrorPopup=!0,v()})},u.saveLayout=E,u.saveLayoutAsDefault=T,u.saveLayoutAsDefaultForCategory=U,u.changeContext=D,u.addWidget=N,u.changeLayout=M,u.reload=w,u.$workspaceContainer.height($(window).height()),u.$workspaceContainer.width($(window).width()),n(function(){f().then(S).then(D).then(O).then(A).then(C).then(L).then(w).then(v).catch(function(e){t.error(e),u.currentError=l.createError(e),u.showErrorPopup=!0,v()})})}]),glDashboard.directive("changeWidgetName",function(){return{restrict:"E",templateUrl:"view.widget.name.html",link:function(t){t.showChangeWidgetnamePopup=!1,t.widgetNewName=t.config.title,t.cannotValidateWidgetNameChange=!0,t.changeWidgetNameButtonOptions={icon:"edit",onClick:function(e){t.widgetNewName=t.config.title,t.showChangeWidgetnamePopup=!0}},t.$watch("widgetNewName",function(){t.cannotValidateWidgetNameChange=""==t.widgetNewName}),t.widgetNameTextBoxOptions={bindingOptions:{value:"widgetNewName"},onInput:function(e){t.cannotValidateWidgetNameChange=""==e.component._options.text},showClearButton:!0},t.changeWidgetNamePopupOptions={width:350,contentTemplate:"info",height:"auto",dragEnabled:!0,showTitle:!0,title:"Change widget name",closeOnOutsideClick:!0,bindingOptions:{visible:"showChangeWidgetnamePopup"}},t.validateChangeNameButtonOptions={text:"Change name",bindingOptions:{disabled:"cannotValidateWidgetNameChange"},onClick:function(){t.changeWidgetName(t.widgetNewName),t.showChangeWidgetnamePopup=!1}}}}}),glDashboard.factory("Save",function(){return function(e,t,n,o){saveAs(new Blob([function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),o=0;o!=e.length;++o)n[o]=255&e.charCodeAt(o);return t}(n)],{type:o||"application/octet-stream"}),e+t)}}),angular.module("oneDasboardTemplates").run(["$templateCache",function(e){e.put("view.widget.name.html",'<div class="menu-item-align" dx-button="changeWidgetNameButtonOptions"></div>\r\n<div class="popup" dx-popup="changeWidgetNamePopupOptions">\r\n    <div data-options="dxTemplate: { name: \'info\' } ">\r\n        <div style="margin-top:10px;" dx-text-box="widgetNameTextBoxOptions"></div>\r\n        <div style="width:100%;margin-top:10px;min-height:30px; ">\r\n            <div style="width:100%;margin:0px" dx-button="validateChangeNameButtonOptions"></div>\r\n        </div>\r\n    </div>\r\n</div>\r\n'),e.put("view.workspace.html",'<div ng-class="{disable: isLoading}" id="workspace">\r\n\r\n    <div id="workspaceContainer" class="w_container"></div>\r\n        <div class="w_menu" id="workspaceMenu" style="border:none">\r\n        <a style="color: transparent!important;" ng-href="#/"><img style="margin-left:0px" class="menu-item" src={{appIcon}}></img>\r\n        </a>\r\n        <div class="menu-item-align">{{appName}}</div>\r\n        <div class="menu-item-align">v.{{appVersion}}</div>\r\n        <div class="menu-item-align">{{fund}}</div>\r\n        <div class="menu-item" dx-menu="widgetMenuOptions"></div>\r\n        <div class="menu-item" dx-menu="actionMenuOptions"></div>\r\n        <div class="menu-item" dx-menu="screenMenuOptions"></div>\r\n        <div class="menu-item" dx-button="saveLayoutDefaultButtonOptions"></div>\r\n        <div class="menu-item" dx-button="saveLayoutTagButtonOptions"></div>\r\n        <div class="menu-item" dx-button="saveLayoutAsScreenOrActionButtonOptions"></div>\r\n        <div class="menu-item" dx-button="layoutManagementButtonOptions"></div>\r\n        <div class="icon-menu-item" dx-button="deleteDefaultLayoutButtonOptions"></div>\r\n    </div>\r\n    <div id="layoutManagementPopup" class="popup" dx-popup="namedLayoutManagementPopupOptions">\r\n        <div data-options="dxTemplate: { name:\'info\' }">\r\n            <div>\r\n                <div id="layoutManagementList" dx-tree-view="layoutManagementTreeViewOptions"></div>\r\n                <div style="margin-top:20px;" style="width:100%;">\r\n                    <div style="float:left;width:45%;" dx-button="loadLayoutButtonOptions"></div>\r\n                    <div style="float:right;width:45%;" dx-button="deleteLayoutButtonOptions"></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div id="layoutManagementPopup" class="popup" dx-popup="layoutManagementPopupOptions">\r\n        <div data-options="dxTemplate: { name:\'info\' }">\r\n            <div class="dx-fieldset">\r\n                <div class="dx-fieldset-header">Create or load a named layout</div>\r\n                <div class="dx-field">\r\n                    <div style="width:100%;min-height:30px;margin-top: 5px;">\r\n                        <div style="float:left;width:35%;" dx-text-box="textBoxNewLayoutOptions"></div>\r\n                        <div style="float:left;width:23%;margin:0px 0px 0px 5px;" dx-button="saveLayoutAsScreenButtonOptions"></div>\r\n                        <div style="float:left;width:20%;margin:0px 0px 0px 5px;" dx-button="saveLayoutAsActionButtonOptions"></div>\r\n                        <div style="float:left;width:20%;margin:0px 0px 0px 5px;" dx-button="namedLayoutManagementButtonOptions"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="dx-fieldset">\r\n                <div class="dx-fieldset-header">Create or load a serialized layout</div>\r\n                <div class="dx-field">\r\n                    <div style="width:100%;min-height:30px;margin-top: 5px;">\r\n                        <div style="float:left;width:45%;margin:0px 5px 0px 0px;" dx-button="saveLayoutAsFileButtonOptions"></div>\r\n                        <div style="float:left;width:45%;margin-top: -7px;" class="menu-item" id="loadLayoutFromFileInput" dx-file-uploader="loadLayoutFromFileUploadOptions"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="popup" dx-popup="errorPopup">\r\n        <div data-options="dxTemplate: { name:\'info\' }">\r\n            <div class="dx-fieldset">\r\n                <div class="dx-field">\r\n                    <div class="dx-field-label">Type</div>\r\n                    <div class="dx-field-value">\r\n                        {{currentError.status}}\r\n                    </div>\r\n                </div>\r\n                <div class="dx-field">\r\n                    <div class="dx-field-label">Message</div>\r\n                    <div class="dx-field-value">\r\n                        {{currentError.message}}\r\n                    </div>\r\n                </div>\r\n                <div class="dx-field">\r\n                    <div class="dx-field-label">Detail</div>\r\n                    <div class="dx-field-value">\r\n                        <div dx-text-area="errorDetails"></div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>\r\n')}]),glDashboard.service("error",function(){this.createError=function(e){var t={status:"",message:"",details:"",inner:null};return(t.inner=e)instanceof Error?(t.status="An error has occured",t.message=e.message,t.details=e.stack):e.hasOwnProperty("statusText")&&e.hasOwnProperty("data")&&e.hasOwnProperty("data")?null!=e.data?(t.status=e.statusText,t.message=e.data.message,t.details=JSON.stringify(e.data)):(t.status="HTTP error - see trace for details",t.message="An error has occured",t.details=JSON.stringify(e.config)):t.details=e,t}});